{"version":3,"sources":["../../../../../assets/script/effct/assets/script/effct/InteractBlotItem.ts"],"names":[],"mappings":";;;;;AAAA,uGAAsG;AACtG,2FAA4F;AAC5F,6EAA4E;AAC5E,+FAA8F;AAIxF,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAG5C;IAA8C,oCAAY;IAD1D;QAAA,qEAoJC;QA7IG,gBAAU,GAAc,IAAI,CAAC;QAG7B,eAAS,GAAY,IAAI,CAAC;QAE1B,kBAAY,GAAU;YAClB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,EAAE;YACpB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE;YACrB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACtB,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE;YACrB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,GAAG,EAAE;YACnB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE;YACpB,E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","file":"","sourceRoot":"../../../../../assets/script/effct","sourcesContent":["import { BlotDataManager } from './../../../../../work/nurture/nurture/assets/script/BlotDataManager';\nimport { TriggerType } from './../../../../../work/nurture/nurture/assets/script/CommonDef';\nimport { EventType } from './../../../../../work/nurture/nurture/creator.d';\nimport { EventCenter } from './../../../../../work/nurture/nurture/assets/script/EventCenter';\n\nimport { EventType } from './EventType';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class InteractBlotItem extends cc.Component {\n\n    @property(cc.Mask)\n    mask: cc.Mask;\n\n    @property(cc.Sprite)\n    blotSprite: cc.Sprite = null;\n\n    @property(cc.Node)\n    touchNode: cc.Node = null;\n\n    eraserPoints: any[] = [\n        { x: -11.5, y: 74.5 },\n        { x: -30.5, y: 64.5 },\n        { x: -41.5, y: 53.5 },\n        { x: -59.5, y: 44.5 },\n        { x: -67.5, y: 34.5 },\n        { x: -66.5, y: 11.5 },\n        { x: -63.5, y: 5.5 },\n        { x: -55.5, y: -3.5 },\n        { x: -51.5, y: -11.5 },\n        { x: -44.5, y: -36.5 },\n        { x: -38.5, y: -47.5 },\n        { x: -33.5, y: -52.5 },\n        { x: -20.5, y: -58.5 },\n        { x: -17.5, y: -62.5 },\n        { x: -15.5, y: -62.5 },\n        { x: -3.5, y: -73.5 },\n        { x: 5.5, y: -74.5 },\n        { x: 11.5, y: -71.5 },\n        { x: 17.5, y: -65.5 },\n        { x: 22.5, y: -56.5 },\n        { x: 36.5, y: -57.5 },\n        { x: 43.5, y: -55.5 },\n        { x: 51.5, y: -49.5 },\n        { x: 53.5, y: -49.5 },\n        { x: 60.5, y: -40.5 },\n        { x: 59.5, y: -34.5 },\n        { x: 57.5, y: -32.5 },\n        { x: 58.5, y: -16.5 },\n        { x: 60.5, y: -13.5 },\n        { x: 61.5, y: -0.5 },\n        { x: 65.5, y: 7.5 },\n        { x: 67.5, y: 16.5 },\n        { x: 67.5, y: 34.5 },\n        { x: 63.5, y: 42.5 },\n        { x: 59.5, y: 44.5 },\n        { x: 49.5, y: 45.5 },\n        { x: 36.5, y: 50.5 },\n        { x: 35.5, y: 52.5 },\n        { x: 27.5, y: 56.5 },\n        { x: 18.5, y: 66.5 },\n        { x: 16.5, y: 66.5 },\n        { x: 9.5, y: 72.5 },\n        { x: 3.5, y: 74.5 }\n    ];\n    onLoad() {\n        this.touchNode.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\n        this.touchNode.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.touchNode.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.touchNode.on(cc.Node.EventType.TOUCH_CANCEL, this.touchCancel, this);\n        EventCenter.onEvent(EventType.CHECK_TRIGGER_STATE, this.onRcvBlotState, this);\n    }\n    onDestroy() {\n        this.touchNode.off(cc.Node.EventType.TOUCH_START, this.touchStart, this);\n        this.touchNode.off(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.touchNode.off(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.touchNode.off(cc.Node.EventType.TOUCH_CANCEL, this.touchCancel, this);\n        EventCenter.offEvent(EventType.CHECK_TRIGGER_STATE, this.onRcvBlotState, this);\n\n    }\n    onRcvBlotState(triggerResult) {\n        if (triggerResult.triggerType === TriggerType.Clean) {\n            let blotList = BlotDataManager.getInstance().getBlotList();\n            if (blotList.length > 0) {\n                //拉近场景\n                EventCenter.post(EventType.CHANGE_SCENE_SHOT, this.node.position);\n            } else {\n                //这个污渍已经被清理过了\n\n            }\n        }\n    }\n\n    // update (dt) {}\n    touchStart(e: cc.Event.EventTouch) {\n        e.stopPropagation();\n        //阻止多点触摸\n        if (e.getID() > 0) {\n            return;\n        }\n        var point = e.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    }\n\n    touchMove(e: cc.Event.EventTouch) {\n        e.stopPropagation();\n        if (e.getID() > 0) {\n            return;\n        }\n        let delta_x = e.getDelta().x;\n        let delta_y = e.getDelta().y;\n        let delta = Math.sqrt((delta_x * delta_x) + (delta_y * delta_y));\n        console.log(\"=============touch move: \", delta);\n        var point = e.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    }\n\n    touchEnd(e: cc.Event.EventTouch) {\n        e.stopPropagation();\n        if (e.getID() > 0) {\n            return;\n        }\n        var point = e.touch.getLocation();\n        point = this.node.convertToNodeSpaceAR(point);\n        this._addCircle(point);\n    }\n\n    touchCancel(e: cc.Event.EventTouch) {\n        e.stopPropagation();\n        if (e.getID() > 0) {\n            return;\n        }\n\n    }\n\n    _addCircle(point) {\n        var stencil = this.mask._clippingStencil;\n        var color = cc.color(255, 255, 255, 0);\n        let p = this.dealPoints(point);\n        stencil.drawPoly(p, color, 0, color);\n        if (!CC_JSB) {\n            cc.renderer.childrenOrderDirty = true;\n        }\n    }\n\n    dealPoints(point: cc.Vec2): cc.Vec2[] {\n        const curPoints = JSON.parse(JSON.stringify(this.eraserPoints));\n        for (let index = 0; index < curPoints.length; index++) {\n            const element = curPoints[index];\n            curPoints[index].x = curPoints[index].x + point.x;\n            curPoints[index].y = curPoints[index].y + point.y;\n        }\n        return curPoints;\n    }\n}\n"]}